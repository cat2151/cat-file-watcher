# issue 実行したcommandの標準出力や標準エラー出力は現在はコンソールで確認できない。確認する方法があるか？を知りたい #56
[issues #56](https://github.com/cat2151/cat-file-watcher/issues/56)

## 調査結果

### 現在の仕組み

コマンドの標準出力および標準エラー出力は、**既にコンソールに表示される仕組み**になっています。

#### 実装詳細 (src/command_executor.py)

1. **コマンド実行**
   - `subprocess.run()` を `capture_output=True, text=True` で実行
   - タイムアウトは30秒に設定

2. **標準出力の表示** (lines 55-57)
   - コマンドが成功（returncode == 0）した場合
   - 標準出力がある場合、コンソールに表示:
     ```python
     if result.stdout:
         print(f"Output: {result.stdout.strip()}")
     ```

3. **標準エラー出力の表示** (lines 58-60)
   - コマンドが失敗した場合
   - 標準エラー出力をコンソールに表示:
     ```python
     print(f"Error (exit code {result.returncode}): {result.stderr.strip()}")
     ```

4. **エラーログファイル** (lines 62-65)
   - コマンドが失敗した場合、`error_log_file` が設定されていれば、エラー情報をログファイルに記録
   - ログには以下が含まれる:
     - エラーメッセージ
     - 実行したコマンド
     - 標準エラー出力

### 例外ケース

- 標準出力が空の場合は何も表示されない（無駄な出力を避けるため）
- コマンド実行前に `suppress_if_process` でスキップされた場合は実行されない

### README への記載必要性

この機能は以下の理由から README に明記すべきと判断しました:

1. **ユーザーの期待値を明確にする**: コマンドの出力がどのように表示されるか明示的に記載することで、利用者の混乱を防ぐ
2. **デバッグ手段の提供**: 標準出力/エラー出力がコンソールで確認できることを知らせることで、トラブルシューティングが容易になる
3. **ログ機能との使い分け**: `enable_log` によるログファイルとコンソール出力の違いを明確にする

## 実装内容

README.ja.md と README.md の「動作の仕組み」セクションに、コマンド実行時の出力について説明を追加します。

## 実装完了

### 第1回実装（ドキュメント追加）

以下の変更を行いました:

1. **README.ja.md への追加**
   - 「動作の仕組み」セクションに「コマンド実行時の出力」サブセクションを追加
   - グローバル設定に `error_log_file` と `suppression_log_file` の説明を追加
   - 設定例に `error_log_file` と `suppression_log_file` の例を追加

2. **README.md への追加**
   - 「How It Works」セクションに「Command Output」サブセクションを追加（英語版）
   - グローバル設定に `error_log_file` と `suppression_log_file` の説明を追加
   - 設定例に `error_log_file` と `suppression_log_file` の例を追加

3. **手動検証**
   - 実際にファイル監視ツールを実行し、標準出力と標準エラー出力がコンソールに正しく表示されることを確認
   - 成功時: `Output: <出力内容>` として表示されることを確認
   - 失敗時: `Error (exit code <コード>): <エラー内容>` として表示されることを確認

### 第2回実装（リアルタイム出力対応）

ユーザーからのフィードバックにより、問題の本質が明らかになりました:
- 1時間など長時間実行されるコマンドの場合、途中経過が一切表示されない
- 途中経過をリアルタイムで確認したい

以下の変更を行いました:

1. **src/command_executor.py の変更**
   - `subprocess.run()` の `capture_output=True` を `capture_output=False` に変更
   - これにより、コマンドの標準出力/標準エラー出力がリアルタイムでコンソールに表示されるようになった
   - 長時間実行されるコマンドでも、途中経過を逐次確認可能に
   - エラーログには stderr の内容を含められなくなったが、エラーメッセージと実行コマンドは記録される

2. **README.ja.md と README.md の更新**
   - 「リアルタイムで」出力が表示されることを明記
   - 長時間実行コマンドでも途中経過が確認できることを追記
   - エラー時の出力形式を実装に合わせて修正

## 結論

イシュー #56 の疑問「実行したcommandの標準出力や標準エラー出力は現在はコンソールで確認できない。確認する方法があるか？」に対する回答:

**コンソールでリアルタイムに確認できます。**

標準出力および標準エラー出力は、コマンド実行中にリアルタイムでコンソールに表示されます。1時間実行されるコマンドでも、途中経過を常時確認できます。さらに、`error_log_file` を設定することで、エラー時の情報をファイルに保存することも可能です。

