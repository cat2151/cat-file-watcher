# issue GitHub ActionsによるRuff実行で、agentのPRしたtrailing space入りのソースがlinter errorとなりブロックされてしまう #74
[issues #74](https://github.com/cat2151/cat-file-watcher/issues/74)

## 問題の分析

### 現象
- GitHub Copilot AgentがPRを作成した際、trailing space（行末の空白）を含むコードが含まれることがある
- 現在のGitHub Actions workflowは`ruff format --check`で検証のみを行い、自動修正を行わない
- チェックが失敗するとPRのマージがブロックされ、イテレーションが停止する

### 根本原因
`.github/workflows/ruff-check.yml`が以下のように検証のみを行う設定になっていた：
```yaml
- name: Run Ruff check
  run: ruff check src/

- name: Run Ruff format check
  run: ruff format --check src/
```

`--check`オプションは問題を検出するだけで、自動修正を行わない。

## 解決策

### 実装内容
GitHub Actionsワークフローを以下のように修正：

1. **自動フォーマットの追加**
   - `ruff format src/` でコードを自動フォーマット（trailing spaceの除去を含む）
   - `ruff check --fix src/` で自動修正可能なlint問題を修正

2. **変更の自動コミット**
   - フォーマットによる変更があれば、自動的にコミット＆プッシュ
   - コミットメッセージに`[skip ci]`を含めて無限ループを防止

3. **検証の実行**
   - 自動フォーマット後に`ruff check`と`ruff format --check`で最終確認

### 修正内容
- `permissions`に`contents: write`を追加（コミット権限のため）
- チェックアウト時に適切なブランチとリポジトリを指定
- Auto-format stepとCommit stepを追加
- pull_request_targetイベント時のみ自動コミットを実行

## 効果

- **Agent PRの自動修正**: trailing spaceなどのフォーマット問題が自動的に修正される
- **イテレーションのブロック解消**: PRが自動的に修正されるため、手動介入なしでマージ可能
- **コード品質の維持**: 最終的なチェックは引き続き実行され、コード品質が保証される

## 検証方法

ローカルでの動作確認：
```bash
# trailing spaceを含むファイルを作成
echo 'def test():  ' > test.py

# 自動フォーマット
ruff format test.py
ruff check --fix test.py

# チェック（成功するはず）
ruff check test.py
ruff format --check test.py
```

